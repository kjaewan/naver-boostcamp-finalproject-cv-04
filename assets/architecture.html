<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>pro-cv 시스템 아키텍처</title>
  <style>
    :root {
      --bg: #e8e8e8;
      --ink: #111827;
      --muted: #334155;
      --line: #1f2937;
      --panel: #ffffff;
      --sub: #f3f4f6;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--ink);
      font-family: "Noto Sans KR", "Malgun Gothic", "Apple SD Gothic Neo", "Segoe UI", sans-serif;
    }

    .wrap {
      max-width: 1680px;
      margin: 0 auto;
      padding: 14px;
    }

    .canvas {
      border: 1px solid #c9c9c9;
      border-radius: 8px;
      background: #ececec;
      overflow: auto;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
    }

    svg {
      width: 100%;
      min-width: 1500px;
      display: block;
      height: auto;
    }

    .frame {
      fill: none;
      stroke: var(--line);
      stroke-width: 2.1;
    }

    .module {
      fill: var(--panel);
      stroke: var(--line);
      stroke-width: 2;
    }

    .submodule {
      fill: var(--sub);
      stroke: #475569;
      stroke-width: 1.3;
    }

    .title {
      font-size: 28px;
      font-weight: 700;
      fill: #111827;
    }

    .module-title {
      font-size: 22px;
      font-weight: 700;
      text-anchor: middle;
      fill: #111827;
    }

    .small {
      font-size: 13px;
      fill: var(--muted);
      text-anchor: middle;
      font-weight: 600;
    }

    .api-line {
      font-size: 12px;
      fill: var(--muted);
      text-anchor: middle;
      font-weight: 700;
    }

    .label {
      font-size: 13px;
      font-weight: 700;
    }

    .edge {
      fill: none;
      stroke-width: 2.5;
    }

    .edge-1 { stroke: #2563eb; marker-end: url(#arrow-1); }
    .edge-2 { stroke: #dc2626; marker-end: url(#arrow-2); }
    .edge-3 { stroke: #16a34a; marker-end: url(#arrow-3); }
    .edge-4 { stroke: #7c3aed; marker-end: url(#arrow-4); }
    .edge-5 { stroke: #ea580c; marker-end: url(#arrow-5); }
    .edge-6 { stroke: #0891b2; marker-end: url(#arrow-6); }
    .edge-7 { stroke: #be123c; marker-end: url(#arrow-7); }
    .edge-8 { stroke: #0f766e; marker-end: url(#arrow-8); }
    .edge-9 { stroke: #a16207; marker-end: url(#arrow-9); }
    .edge-10 { stroke: #4338ca; marker-end: url(#arrow-10); }
    .edge-11 { stroke: #0e7490; marker-end: url(#arrow-11); }
    .edge-12 { stroke: #475569; marker-end: url(#arrow-12); }

    .label-1 { fill: #1d4ed8; }
    .label-2 { fill: #b91c1c; }
    .label-3 { fill: #15803d; }
    .label-4 { fill: #6d28d9; }
    .label-5 { fill: #c2410c; }
    .label-6 { fill: #0e7490; }
    .label-7 { fill: #9f1239; }
    .label-8 { fill: #0f766e; }
    .label-9 { fill: #854d0e; }
    .label-10 { fill: #3730a3; }
    .label-11 { fill: #0e7490; }
    .label-12 { fill: #334155; }

    .host-cloud {
      fill: #34d399;
      stroke: #059669;
      stroke-width: 1.5;
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="canvas">
      <svg viewBox="0 0 1640 920" role="img" aria-label="pro-cv 시스템 아키텍처 다이어그램">
        <defs>
          <marker id="arrow-1" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#2563eb"></path></marker>
          <marker id="arrow-2" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#dc2626"></path></marker>
          <marker id="arrow-3" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#16a34a"></path></marker>
          <marker id="arrow-4" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#7c3aed"></path></marker>
          <marker id="arrow-5" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#ea580c"></path></marker>
          <marker id="arrow-6" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#0891b2"></path></marker>
          <marker id="arrow-7" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#be123c"></path></marker>
          <marker id="arrow-8" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#0f766e"></path></marker>
          <marker id="arrow-9" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#a16207"></path></marker>
          <marker id="arrow-10" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#4338ca"></path></marker>
          <marker id="arrow-11" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#0e7490"></path></marker>
          <marker id="arrow-12" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="8" markerHeight="8" orient="auto-start-reverse"><path d="M 0 0 L 10 5 L 0 10 z" fill="#475569"></path></marker>
        </defs>

        <!-- 프레임 -->
        <rect class="frame" x="90" y="45" width="1470" height="820" rx="14" ry="14"></rect>
        <rect class="frame" x="140" y="85" width="1370" height="750" rx="12" ry="12"></rect>
        <text class="title" x="1265" y="64">시스템 아키텍처</text>

        <!-- 사용자 -->
        <g transform="translate(32,198)">
          <circle cx="24" cy="24" r="24" fill="#ffffff" stroke="#111827" stroke-width="2.6"></circle>
          <circle cx="24" cy="17" r="8" fill="none" stroke="#111827" stroke-width="2.1"></circle>
          <path d="M 10 35 C 10 28, 17 25, 24 25 C 31 25, 38 28, 38 35" fill="none" stroke="#111827" stroke-width="2.1"></path>
          <text x="4" y="68" font-size="14" font-weight="700">사용자</text>
        </g>

        <!-- 프론트엔드 -->
        <rect class="module" x="190" y="145" width="230" height="280" rx="12" ry="12"></rect>
        <text class="module-title" x="305" y="178">프론트엔드</text>
        <text class="small" x="305" y="212">React + Vite (:5173)</text>
        <text class="small" x="305" y="242">곡 검색/선택</text>
        <text class="small" x="305" y="266">렌더 요청</text>
        <text class="small" x="305" y="290">렌더 상태 폴링</text>

        <rect class="submodule" x="208" y="358" width="194" height="54" rx="8" ry="8"></rect>
        <text class="small" x="305" y="389">YouTube 오디오 플레이어(선택)</text>

        <!-- 백엔드 -->
        <rect class="module" x="520" y="145" width="300" height="320" rx="12" ry="12"></rect>
        <text class="module-title" x="670" y="178">백엔드</text>
        <text class="small" x="670" y="206">FastAPI + Uvicorn (:8000)</text>

        <rect class="submodule" x="540" y="224" width="260" height="36" rx="8" ry="8"></rect>
        <text class="api-line" x="670" y="246">음악 검색 에이피아이 (/api/v1/music/search)</text>

        <rect class="submodule" x="540" y="268" width="260" height="36" rx="8" ry="8"></rect>
        <text class="api-line" x="670" y="290">렌더 생성 에이피아이 (/api/v1/renders)</text>

        <rect class="submodule" x="540" y="312" width="260" height="36" rx="8" ry="8"></rect>
        <text class="api-line" x="670" y="334">상태 조회 에이피아이 (/api/v1/renders/:job_id)</text>

        <rect class="submodule" x="540" y="356" width="260" height="36" rx="8" ry="8"></rect>
        <text class="api-line" x="670" y="378">히스토리 조회/삭제 (/api/v1/renders/history)</text>

        <rect class="submodule" x="540" y="400" width="260" height="28" rx="8" ry="8"></rect>
        <text class="small" x="670" y="419">메모리 큐 워커</text>

        <!-- 스토리지 -->
        <rect class="module" x="860" y="145" width="290" height="280" rx="12" ry="12"></rect>
        <text class="module-title" x="1005" y="178">스토리지</text>
        <text class="small" x="1005" y="212">로컬 파일 저장소</text>
        <text class="small" x="1005" y="240">data/inputs (앨범 이미지)</text>
        <text class="small" x="1005" y="266">data/jobs (*.json)</text>
        <text class="small" x="1005" y="292">data/renders/&lt;cache_key&gt;</text>
        <text class="small" x="1005" y="318">/static/* 정적 서빙</text>
        <text class="small" x="1005" y="344">캐시 키: 이미지+workflow+preset</text>
        <text class="small" x="1005" y="370">데이터베이스는 추후 도입 예정</text>

        <!-- 음악 검색 외부 API -->
        <rect class="module" x="1180" y="145" width="300" height="280" rx="12" ry="12"></rect>
        <text class="module-title" x="1330" y="178">음악 검색 외부 API</text>

        <rect class="submodule" x="1200" y="232" width="260" height="64" rx="10" ry="10"></rect>
        <text class="small" x="1330" y="260">iTunes Search API</text>
        <text class="small" x="1330" y="282">기본 후보 25개 수집</text>

        <rect class="submodule" x="1200" y="312" width="260" height="64" rx="10" ry="10"></rect>
        <text class="small" x="1330" y="340">YouTube Data API</text>
        <text class="small" x="1330" y="362">top-k 메타데이터 보강(선택)</text>

        <text class="small" x="1330" y="396">최종 점수 계산 후 상위 N개 반환</text>

        <!-- 렌더 파이프라인 -->
        <rect class="module" x="470" y="500" width="1010" height="290" rx="12" ry="12"></rect>
        <text class="module-title" x="975" y="536">렌더 파이프라인</text>

        <rect class="module" x="560" y="565" width="290" height="170" rx="10" ry="10"></rect>
        <text class="small" x="705" y="600">ComfyUI (:8188)</text>
        <text class="small" x="705" y="626">워크플로 로드 + 프롬프트 큐</text>
        <text class="small" x="705" y="652">히스토리 조회</text>

        <rect class="module" x="900" y="595" width="170" height="110" rx="10" ry="10"></rect>
        <text class="small" x="985" y="632">ffmpeg</text>
        <text class="small" x="985" y="656">mp4/썸네일</text>

        <text x="580" y="470" font-size="18" font-weight="700" fill="#0f766e">워크플로 파일: workflows/(API)Final_workflow.json</text>

        <!-- 호스트 -->
        <g transform="translate(235,710)">
          <ellipse class="host-cloud" cx="0" cy="16" rx="15" ry="11"></ellipse>
          <ellipse class="host-cloud" cx="17" cy="12" rx="12" ry="10"></ellipse>
          <ellipse class="host-cloud" cx="31" cy="18" rx="13" ry="10"></ellipse>
          <rect class="host-cloud" x="-13" y="17" width="56" height="17" rx="8"></rect>
          <text x="15" y="30" font-size="14" text-anchor="middle" fill="#ffffff" font-weight="700">브이피씨</text>
        </g>
        <text x="285" y="790" font-size="20" font-weight="700" fill="#111827">실행 호스트 (run_all.sh)</text>

        <!-- 화살표 -->
        <path class="edge edge-1" d="M 76 220 L 190 220"></path>
        <text class="label label-1" x="98" y="202">요청</text>

        <path class="edge edge-2" d="M 190 260 L 76 260"></path>
        <text class="label label-2" x="96" y="282">응답</text>

        <path class="edge edge-3" d="M 420 215 L 520 215"></path>
        <text class="label label-3" x="442" y="198">에이피아이 요청</text>

        <path class="edge edge-4" d="M 520 259 L 420 259"></path>
        <text class="label label-4" x="430" y="281">검색 결과/상태/결과</text>

        <path class="edge edge-5" d="M 820 220 L 860 220"></path>
        <text class="label label-5" x="822" y="202">메타데이터/캐시 조회</text>

        <path class="edge edge-6" d="M 860 264 L 820 264"></path>
        <text class="label label-6" x="815" y="286">캐시 적중/결과 주소</text>

        <path class="edge edge-7" d="M 670 465 L 670 535 L 640 535 L 640 565"></path>
        <text class="label label-7" x="548" y="520">렌더 작업 큐 전달</text>

        <path class="edge edge-8" d="M 850 640 L 900 640"></path>
        <text class="label label-8" x="838" y="622">원본 출력</text>

        <path class="edge edge-9" d="M 1070 640 L 1110 640 L 1110 425"></path>
        <text class="label label-9" x="1078" y="622">mp4/썸네일 저장</text>

        <path class="edge edge-10" d="M 820 246 L 1200 246"></path>
        <text class="label label-10" x="905" y="228">iTunes 검색 요청/응답</text>

        <path class="edge edge-11" d="M 820 340 L 1200 340"></path>
        <text class="label label-11" x="894" y="362">YouTube 메타 조회(선택)/응답</text>

        <path class="edge edge-12" d="M 1030 425 L 1030 470 L 420 470 L 420 360"></path>
        <text class="label label-12" x="560" y="488">/static/renders/* 서빙</text>
      </svg>
    </section>
  </main>
</body>
</html>
